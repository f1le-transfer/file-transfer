<html>
  <head>
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/img/1.jpeg">

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#764ABC"/>
  </head>
  <body>
    <span>You are now</span> <span><b class="page-status">online</b></span><br>
    <button id="open_btn">send file</button><br>
    <button id="send_btn">send message to the tcp server</button>

    <script src="/pwa.js"></script>
    <script src="/status.js"></script>
    <script>
      // Channel for communicate between window and worker
      const broadcast = new BroadcastChannel('tcp_channel'); 
      broadcast.addEventListener('message', ({ data }) => console.log(data))

      document.getElementById('send_btn').onclick = () => {
        broadcast.postMessage({ msg: prompt('msg?') })
      };

      let fileHandle;
      document.getElementById('open_btn').addEventListener('click', async () => {
        // Destructure the one-element array.
        [fileHandle] = await window.showOpenFilePicker();
        const [filename, ext] = fileHandle.name.split('.')

        const file = await fileHandle.getFile();
        const file_stream = file.stream();
        
        console.log(file_stream)
      });
    </script>
  </body>
</html>